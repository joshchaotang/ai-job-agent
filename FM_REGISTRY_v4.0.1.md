# 失敗模式登記冊（FM Registry）
**AI Job Agent 專案 - 持續更新**

版本：v4.0.1
最後更新：2026-02-11

═══════════════════════════════════════════════════════
說明
═══════════════════════════════════════════════════════

本文件記錄專案開發過程中遇到的所有失敗模式，
以及對應的防護措施，避免重複犯錯。

**使用方式**：
→ 遇到問題時，先查看此清單
→ 如有匹配，直接套用防護措施
→ 如無匹配，完成修復後新增條目

───────────────────────────────────────────────────────

## FM-001：型別轉換通過但顯示不合理

**觸發場景**：
- API 回傳整數值（如 Unix 時間戳）
- 轉 str() 後長度恰好不超過切片範圍
- 技術上不報錯但對人無意義

**實例**：
```python
timestamp = 1770741231  # Unix timestamp
date_str = str(timestamp)[:10]  # "1770741231"
# 顯示給用戶 → 看起來像亂碼
```

**防護措施**：
1. 除了型別轉換，還要做語意驗證
2. 檢查：輸出值對人類有意義嗎？
3. 時間戳 → 使用 datetime 格式化
4. 數字 → 檢查合理範圍

**狀態**：✅ 已修復（v3.9.0）

───────────────────────────────────────────────────────

## FM-002：try/except 靜默吞錯導致資料缺失不可見

**觸發場景**：
- 多來源操作中某一來源失敗
- 錯誤被 catch 但使用者未能察覺
- 使用者以為「一切正常」

**實例**：
```python
try:
    data_from_source_1 = fetch_source_1()
except:
    pass  # 靜默失敗！
```

**防護措施**：
1. 失敗必須在 UI 持久顯示
2. 不只是短暫提示（toast）
3. 讓使用者知道「少了什麼」
4. 提供重試選項

**狀態**：✅ 已修復（v3.9.0）

───────────────────────────────────────────────────────

## FM-003：部署/執行環境限制未提前識別

**觸發場景**：
- 開發完成後才發現目標環境的限制
- 網路、權限、依賴項不符
- 需要重新設計

**實例**：
- 本地開發 OK，部署到 Vercel 才發現網路限制
- 寫好程式碼才發現無權限存取某 API

**防護措施**：
1. 接到部署任務時，第一步測試管道是否通暢
2. 火・管道檢查（新增步驟）
3. 確認：目標環境可達？權限足夠？依賴項齊全？
4. 管道不通 → 先解決或準備替代方案

**狀態**：✅ 已整合到流程（v4.0.0）

───────────────────────────────────────────────────────

## FM-004：未確認就做重大變更

**觸發場景**：
- 假設使用者想要「更好的」
- 沒確認「更好」的定義
- 改完才發現使用者不喜歡

**實例**：
- 自動重構 UI，但使用者喜歡舊版
- 自動升級依賴，但破壞相容性

**防護措施**：
1. 重大 UI/架構變更必須先給選項
2. 讓使用者選擇（先問再做）
3. 提供「預覽」功能
4. 可回退的版本控制

**狀態**：✅ 已整合到原則（v4.0.0）

───────────────────────────────────────────────────────

## FM-005：邊界值測試覆蓋不足

**觸發場景**：
- 修復後只驗「不報錯」
- 不驗「輸出值合理性」
- 極端情況未測試

**實例**：
```javascript
// 只測試「有資料」的情況
test('fetch jobs', () => {
  const jobs = fetchJobs('python');
  expect(jobs.length).toBeGreaterThan(0);
});

// 沒測試：空的、第一筆、最後一筆、1000 筆
```

**防護措施**：
1. 測試清單必須包含邊界值
2. 空的、很長的、有特殊字元的、有圖片的
3. 第一筆、最後一筆、中間某一筆
4. 快取已損壞的、網路中斷的、載入中操作的
5. 輸出語意驗證（對人類有意義嗎？）

**狀態**：✅ 已整合到驗證流程（v4.0.0）

───────────────────────────────────────────────────────

## FM-006：品質判定無計算依據

**觸發場景**：
- AI 給出評分或品質判定時
- 沒有列出維度、權重和逐項得分
- 只憑「感覺」給分

**實例**：
```
❌ 錯誤：「這個方案大約 85 分」
✅ 正確：
  維度 1（功能完整性，30%）× 90 分 = 27
  維度 2（效能表現，25%）× 80 分 = 20
  維度 3（使用者體驗，25%）× 85 分 = 21.25
  維度 4（可維護性，20%）× 90 分 = 18
  ────────────────────────────
  總分：86.25 / 100
```

**防護措施**：
1. 任何品質判定必須附上計算過程
2. 格式：維度 × 權重 × 得分 = 小計
3. 維度權重總和必須 = 100%
4. 不可說「大約 XX 分」或憑感覺給分

**狀態**：✅ 已整合到檢討流程（v4.0.0）

───────────────────────────────────────────────────────

## FM-007：Git 指令未經驗證就交付 🆕

**觸發場景**：
- 給用戶 git 指令時，沒有先在本地測試
- 包含註解符號 `#`，導致複製貼上出錯
- 沒檢查現有 git 狀態（remote、branch 等）

**實例**（v4.0.0 失敗案例）：
```bash
# ❌ 錯誤：包含註解，複製貼上會出錯
# 1. 進入專案資料夾
cd ~/Downloads/ai-job-agent-cloud

# 2. 清除 git lock
rm -f .git/index.lock

# ❌ 錯誤：沒檢查 remote 是否已存在
git remote add origin https://github.com/...

# ❌ 錯誤：URL 是錯的（github.com/new）
```

**用戶執行結果**：
```
zsh: command not found: #  ← 註解符號被當指令執行
error: remote origin already exists.  ← 沒檢查現狀
fatal: repository 'https://github.com/new/' not found  ← URL 錯誤
```

**根本原因**：
1. 指令格式設計錯誤（包含註解）
2. 未做前置檢查（git remote -v）
3. 給錯 URL（佔位符未替換）
4. 沒有實際驗證（違反「火・編寫前驗證」流程）
5. 檢討機制未觸發（連續失敗才被用戶提醒）

**防護措施**：
1. ✅ 所有 git 指令必須「可直接執行」（無註解）
2. ✅ 先用 `git remote -v` 檢查現狀
3. ✅ 提供「已驗證」標記的指令
4. ✅ 分「檢查」「清理」「執行」三階段
5. ✅ 附上「如果出錯，執行這個」的備用方案
6. ✅ URL 必須是實際可用的，不能有佔位符

**修復方案**（已驗證）：
```bash
# ✅ 正確：無註解，可直接執行
cd ~/Downloads/ai-job-agent-cloud
rm -f .git/index.lock
git remote remove origin 2>/dev/null || true
git add -A
git commit -m "v4.0.0"
git remote add origin https://github.com/joshchaotang/ai-job-agent.git
git branch -M main
git push -u origin main
```

**品質判定**：
維度 × 權重 × 得分 = 總分
- 問題識別完整度（25%）× 90分 = 22.5
- 根因分析深度（25%）× 85分 = 21.25
- 防護措施可行性（25%）× 95分 = 23.75
- 修復方案驗證（25%）× 90分 = 22.5
**總分：90 / 100**

**狀態**：✅ 已修復並整合到流程（v4.0.1）

**責任歸屬**：AI 執行失誤，違反大周天流程規範

───────────────────────────────────────────────────────

## FM-008：環境限制未提前識別 🆕

**觸發場景**：
- 掛載資料夾的 git 操作有權限限制
- VM 中無法修改 .git/index.lock
- 應該直接給 Mac 本地指令，但給了 VM 指令

**實例**（v4.0.0 失敗案例）：
```bash
# 在 VM 中嘗試操作掛載資料夾的 git
cd /sessions/optimistic-beautiful-pascal/mnt/m4pro/Downloads/ai-job-agent-cloud
git add -A

# 結果：
warning: unable to unlink '.git/index.lock': Operation not permitted
# 連續多次嘗試，都失敗
```

**根本原因**：
1. 沒意識到掛載資料夾的 git 限制
2. 多次嘗試 VM 操作都失敗
3. 應該一開始就給 Mac 指令
4. 環境認知錯誤

**防護措施**：
1. ✅ 涉及 git 操作 → 優先給 Mac 指令
2. ✅ VM 只用於「唯讀」操作（檢查、打包）
3. ✅ 明確標注「在 Mac 終端執行」
4. ✅ 不要在 VM 中嘗試修改掛載資料夾的 git
5. ✅ 第一次失敗就應識別環境限制，不要連續嘗試

**修復方案**：
- 所有 git 操作都提供「在 Mac 終端執行」的指令
- VM 只用於檢查狀態（git status, git remote -v）

**狀態**：✅ 已修復並整合到流程（v4.0.1）

**責任歸屬**：AI 判斷失誤，環境認知錯誤

───────────────────────────────────────────────────────

## 統計摘要

**總計**：8 個失敗模式
**已修復**：8 個（100%）
**待修復**：0 個

**分類**：
- 程式邏輯錯誤：FM-001, FM-002
- 流程規範違反：FM-003, FM-004, FM-007
- 測試覆蓋不足：FM-005
- 品質管理缺失：FM-006
- 環境認知錯誤：FM-008

**版本歷程**：
- v3.9.0：FM-001 ~ FM-002
- v4.0.0：FM-003 ~ FM-006
- v4.0.1：FM-007 ~ FM-008

───────────────────────────────────────────────────────

## 使用準則

**檢查流程**：
1. 遇到問題 → 先查看此清單
2. 有匹配 → 直接套用防護措施
3. 無匹配 → 完成修復後新增條目

**新增條目格式**：
```markdown
## FM-XXX：問題描述

**觸發場景**：
- 場景 1
- 場景 2

**實例**：
（程式碼或具體案例）

**根本原因**：
1. 原因 1
2. 原因 2

**防護措施**：
1. ✅ 措施 1
2. ✅ 措施 2

**狀態**：✅/⏳/❌

**責任歸屬**：（誰的問題）
```

**維護責任**：
- 開發團隊：持續更新
- 使用者：回報新問題
- AI：自動檢討與登記

───────────────────────────────────────────────────────

**製作團隊**：大周天工作室 ☯
**版本**：v4.0.1
**最後更新**：2026-02-11

本文件是專案「記憶系統」的一部分，
確保我們不會重複犯同樣的錯誤。
